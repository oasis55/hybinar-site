module.controller('listCtrl', ['$scope', '$http', '$location', '$route', '$timeout', function ($scope, $http, $location, $route, $timeout) {    $scope.id             = $route.current.params.id;    $scope.action         = $route.current.params.action;    $scope.userEmpty      = {        name: '',        email: ''    };    $scope.listModel      = {        name: '',        users: [angular.copy($scope.userEmpty)]    };    $scope.listForm       = null;    $scope.add            = false;    $scope.changed        = false;    $scope.loaderShow     = false;    $scope.pageLoaderShow = true;    function watch () {        $scope.$watch('listModel', function (value, oldValue) {            if (value != oldValue) {                $scope.changed = true;            }        }, true);    }    if ($scope.id != 'add') {        $scope.add = false;        $http            .get('cabinet/lists/' + $scope.id)            .success(function (data, status) {                if (status === 200) {                    $scope.listModel = data;                    $scope.listModel.users.push(angular.copy($scope.userEmpty));                    if ($scope.action === 'copy') {                        $scope.listModel.name = '';                        $scope.add = true;                    }                    watch();                    $scope.pageLoaderShow = false;                }            })            .error(function () {})    } else {        $scope.add = true;        $scope.pageLoaderShow = false;        watch();    }    $scope.close = function () {        $location.path('lists');    };    $scope.save = function () {        if ($scope.changed) {            $scope.listForm.$setSubmitted(true);            $timeout(function () {                if ($scope.listForm.$valid) {                    $scope.changed = false;                    $scope.loaderShow = true;                    var listModel = angular.copy($scope.listModel);                    listModel.users.splice(-1);                    if ($scope.add) {                        $http                            .post('cabinet/lists/', listModel)                            .success(function (data, status) {                                if (status === 200) {                                    $location.path('lists');                                }                            })                            .error(function () {});                    } else {                        $http                            .put('cabinet/lists/' + $scope.id, listModel)                            .success(function (data, status) {                                if (status === 200) {                                    $scope.loaderShow = false;                                }                            })                            .error(function () {});                    }                }            }, 1);        }    };    $scope.copy = function () {        $location.path('lists/' + $scope.id + '/copy')    };    $scope.delete = function () {        $http            .delete('cabinet/lists/' + $scope.id)            .success(function (data, status) {                if (status === 200) {                    $location.path('lists');                }            })            .error(function () {});    };    $scope.addUser = function () {        $scope.listModel.users.push(angular.copy($scope.userEmpty));    };    $scope.deleteUser = function (index) {        $scope.listModel.users.splice(index, 1);    };}]);